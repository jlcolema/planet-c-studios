var mediaLibraryOrganizerUploader=!1;jQuery(document).ready((function(e){"undefined"!=typeof mediaLibraryOrganizerSelectizeInit&&mediaLibraryOrganizerSelectizeInit(),e("body").on("click","#mlo-category-tabs a",(function(r){r.preventDefault();var i=e(this).attr("href");e(this).parent().addClass("tabs").siblings("li").removeClass("tabs"),e(".tabs-panel").hide(),e(i).show()}))})),function(e,r){void 0!==wp.Uploader&&r.extend(wp.Uploader.prototype,{init:function(){wp.media.events.trigger("mlo:grid:attachment:upload:init")},added:function(e){wp.media.events.trigger("mlo:grid:attachment:upload:added",e)},progress:function(e){wp.media.events.trigger("mlo:grid:attachment:upload:progress",e)},success:function(e){wp.media.events.trigger("mlo:grid:attachment:upload:success",e)},error:function(e){wp.media.events.trigger("mlo:grid:attachment:upload:error",e)},complete:function(){wp.media.events.trigger("mlo:grid:attachment:upload:complete")},refresh:function(){wp.media.events.trigger("mlo:grid:attachment:upload:refresh")}})}(jQuery,_),function(){if(1==media_library_organizer_media.settings.taxonomy_enabled)var e=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-filter",createFilters:function(){var e={};_.each(media_library_organizer_media.terms||{},(function(r,i){e[i]={text:r.name+" ("+r.count+")",props:{"mlo-category":r.slug}}})),e.all={text:"All Media Categories",props:{"mlo-category":""},priority:10},e.unassigned={text:"(Unassigned)",props:{"mlo-category":"-1"},priority:10},this.filters=e},change:function(){var e=this.filters[this.el.value];e&&(this.model.set(e.props),wp.media.events.trigger("mlo:grid:filter:change:mlo-category",{slug:e.props["mlo-category"]}))},select:function(){var e=this.model,r="all",i=e.toJSON();wp.media.events.trigger("mlo:grid:filter:select",{props:i}),_.find(this.filters,(function(e,t){var a;if(_.all(e.props,(function(e,r){return e===(_.isUndefined(i[r])?null:i[r])})))return r=t})),this.$el.val(r)}});if(1==media_library_organizer_media.settings.orderby_enabled)var r=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-orderby",createFilters:function(){var e={};_.each(media_library_organizer_media.orderby||{},(function(r,i){e[i]={text:r,props:{orderby:i}}})),this.filters=e,this.model.get("orderby")||(1==media_library_organizer_media.user_options.order_enabled?this.model.set("orderby",media_library_organizer_media.user_options.orderby):this.model.set("orderby",media_library_organizer_media.defaults.orderby))}});if(1==media_library_organizer_media.settings.order_enabled)var i=wp.media.view.AttachmentFilters.extend({id:"media-attachment-taxonomy-order",createFilters:function(){var e={};_.each(media_library_organizer_media.order||{},(function(r,i){e[i]={text:r,props:{order:i}}})),this.filters=e,this.model.get("order")||(1==media_library_organizer_media.user_options.order_enabled?this.model.set("order",media_library_organizer_media.user_options.order):this.model.set("order",media_library_organizer_media.defaults.order))}});var t=wp.media.view.AttachmentsBrowser;wp.media.view.AttachmentsBrowser=wp.media.view.AttachmentsBrowser.extend({initialize:function(){t.prototype.initialize.call(this),this.collection.on("attachments:received",(function(e){wp.media.events.trigger("mlo:grid:attachments:received",e)})),this.controller.on("selection:action:done",(function(){wp.media.events.trigger("mlo:grid:attachments:bulk_actions:done")}))},createToolbar:function(){t.prototype.createToolbar.call(this),1==media_library_organizer_media.settings.taxonomy_enabled&&this.toolbar.set("MediaLibraryOrganizerTaxonomyFilter",new e({controller:this.controller,model:this.collection.props,priority:-75}).render()),1==media_library_organizer_media.settings.orderby_enabled&&this.toolbar.set("MediaLibraryOrganizerTaxonomyOrderBy",new r({controller:this.controller,model:this.collection.props,priority:-75}).render()),1==media_library_organizer_media.settings.order_enabled&&this.toolbar.set("MediaLibraryOrganizerTaxonomyOrder",new i({controller:this.controller,model:this.collection.props,priority:-75}).render())}});var a=wp.media.model.Query,o;_.extend(a,{get:(o=[],function(e,r){var i={},t=a.orderby,n=a.defaultProps,d,l=!1;return delete e.query,delete e.cache,_.defaults(e,n),e.order=e.order.toUpperCase(),"DESC"!==e.order&&"ASC"!==e.order&&(e.order=n.order.toUpperCase()),_.contains(t.allowed,e.orderby)||(e.orderby=n.orderby),_.each(["include","exclude"],(function(r){e[r]&&!_.isArray(e[r])&&(e[r]=[e[r]])})),_.each(e,(function(e,r){_.isNull(e)||(i[a.propmap[r]||r]=e)})),_.defaults(i,a.defaultArgs),i.orderby=t.valuemap[e.orderby]||e.orderby,l=!1,o=[],d||(d=new a([],_.extend(r||{},{props:e,args:i})),o.push(d)),wp.media.events.trigger("mlo:grid:query",{query:d}),d})})}(jQuery,_),wp.media.events.on("mlo:grid:attachment:upload:init",(function(){mediaLibraryOrganizerUploader||void 0===wp.media.frame.uploader||(mediaLibraryOrganizerUploader=wp.media.frame.uploader),mediaLibraryOrganizerUploader&&(mediaLibraryOrganizerUploader.uploader.uploader.settings.multipart_params.media_library_organizer={"mlo-category":media_library_organizer_media.selected_term})})),wp.media.events.on("mlo:grid:filter:change:mlo-category",(function(e){mediaLibraryOrganizerUploader&&(mediaLibraryOrganizerUploader.uploader.uploader.settings.multipart_params.media_library_organizer={"mlo-category":e.slug})})),wp.media.events.on("mlo:grid:attachment:upload:success",(function(e){void 0!==wp.media.frame.library?wp.media.frame.library.props.set({ignore:+new Date}):(wp.media.frame.content.get().collection.props.set({ignore:+new Date}),wp.media.frame.content.get().options.selection.reset())}));