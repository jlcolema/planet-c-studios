function mediaLibraryOrganizerTreeViewContextMenuInit(){var e;(e=jQuery)("#media-library-organizer-tree-view-list").contextmenu({delegate:".cat-item",menu:media_library_organizer_tree_view.context_menu,select:function(e,r){var i=mediaLibraryOrganizerTreeViewGetTermIDFromElement(r.target.parent()),a=mediaLibraryOrganizerTreeViewGetTermNameFromElement(r.target);switch(r.cmd){case"create_term":mediaLibraryOrganizerTreeViewAddCategory(i);break;case"edit_term":mediaLibraryOrganizerTreeViewEditCategory(i,a);break;case"delete_term":mediaLibraryOrganizerTreeViewDeleteCategory(i,a);break}}})}function mediaLibraryOrganizerTreeViewAddCategory(e){!function(r){var i=prompt(media_library_organizer_tree_view.create_term.prompt);if(i&&i.length){var a={action:media_library_organizer_tree_view.create_term.action,nonce:media_library_organizer_tree_view.create_term.nonce,taxonomy_name:media_library_organizer_tree_view.taxonomy.name,term_name:i,term_parent_id:e};a[media_library_organizer_tree_view.taxonomy.name]=media_library_organizer_tree_view.selected_term,r.post(media_library_organizer_tree_view.ajaxurl,a,(function(e){if(e.success){var r=e.data;r.selected_term=media_library_organizer_tree_view.selected_term,r.media_view=media_library_organizer_tree_view.media_view,wp.media.events.trigger("mlo:grid:tree-view:added:term",r),mediaLibraryOrganizerTreeViewGet(r.taxonomy.name,r.selected_term)}else alert(e.data)}))}}(jQuery)}function mediaLibraryOrganizerTreeViewEditCategory(e,r){!function(i){if(e){var a=prompt(media_library_organizer_tree_view.edit_term.prompt,r);if(a&&a.length){var t={action:media_library_organizer_tree_view.edit_term.action,nonce:media_library_organizer_tree_view.edit_term.nonce,taxonomy_name:media_library_organizer_tree_view.taxonomy.name,term_id:e,term_name:a};t[media_library_organizer_tree_view.taxonomy.name]=media_library_organizer_tree_view.selected_term,i.post(media_library_organizer_tree_view.ajaxurl,t,(function(e){if(e.success){var r=e.data;r.selected_term=media_library_organizer_tree_view.selected_term,r.media_view=media_library_organizer_tree_view.media_view,wp.media.events.trigger("mlo:grid:tree-view:edited:term",r),mediaLibraryOrganizerTreeViewGet(r.taxonomy.name,r.selected_term)}else alert(e.data)}))}}else alert(media_library_organizer_tree_view.edit_term.no_selection)}(jQuery)}function mediaLibraryOrganizerTreeViewDeleteCategory(e,r){!function(i){var a;if(e){if(confirm(media_library_organizer_tree_view.delete_term.prompt+" "+r)){var t={action:media_library_organizer_tree_view.delete_term.action,nonce:media_library_organizer_tree_view.delete_term.nonce,taxonomy_name:media_library_organizer_tree_view.taxonomy.name,term_id:e};t[media_library_organizer_tree_view.taxonomy.name]=media_library_organizer_tree_view.selected_term,i.post(media_library_organizer_tree_view.ajaxurl,t,(function(e){if(e.success){var r=e.data;r.selected_term=media_library_organizer_tree_view.selected_term,r.media_view=media_library_organizer_tree_view.media_view,wp.media.events.trigger("mlo:grid:tree-view:deleted:term",r),mediaLibraryOrganizerTreeViewGet(r.taxonomy.name,r.selected_term)}else alert(e.data)}))}}else alert(media_library_organizer_tree_view.delete_term.no_selection)}(jQuery)}function mediaLibraryOrganizerTreeViewAssignAttachmentsToCategory(e,r){var i;i=jQuery,e&&r&&i.post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.categorize_attachments.action,nonce:media_library_organizer_tree_view.categorize_attachments.nonce,taxonomy_name:media_library_organizer_tree_view.taxonomy.name,attachment_ids:e,term_id:r},(function(e){if(e.success){wpzinc_notification_show_success_message(e.data.attachments.length+" Attachments Categorized.");var r=e.data;r.selected_term=media_library_organizer_tree_view.selected_term,r.media_view=media_library_organizer_tree_view.media_view,wp.media.events.trigger("mlo:grid:tree-view:assigned:attachments:term",r)}else wpzinc_notification_show_error_message(e.data)}))}function mediaLibraryOrganizerTreeViewContextualButtons(){var e;(e=jQuery)("#media-library-organizer-tree-view-list .current-cat").length?(e("button.media-library-organizer-tree-view-edit").prop("disabled",!1),e("button.media-library-organizer-tree-view-delete").prop("disabled",!1)):(e("button.media-library-organizer-tree-view-edit").prop("disabled",!0),e("button.media-library-organizer-tree-view-delete").prop("disabled",!0))}function mediaLibraryOrganizerTreeViewGet(e,r){var i;(i=jQuery).post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.get_tree_view.action,nonce:media_library_organizer_tree_view.get_tree_view.nonce,taxonomy_name:e,current_term:r},(function(e){if(!e.success)return!1;mediaLibraryOrganizerTreeViewDestroyJsTree(),i("#media-library-organizer-tree-view-list").html(e.data),mediaLibraryOrganizerTreeViewInitJsTree(),mediaLibraryOrganizerTreeViewContextualButtons(),mediaLibraryOrganizerTreeViewInitDroppable(),wp.media.events.trigger("mlo:grid:tree-view:loaded")}))}function mediaLibraryOrganizerTreeViewInitJsTree(){var e;(e=jQuery)(".media-library-organizer-tree-view-enabled").length&&(e("li.current-cat-ancestor",e(".media-library-organizer-tree-view-enabled")).each((function(){e(this).addClass("jstree-open")})),e(".media-library-organizer-tree-view-enabled").jstree().bind("select_node.jstree",(function(e,r){document.location.href=r.node.a_attr.href})).bind("open_node.jstree",(function(e,r){mediaLibraryOrganizerTreeViewInitDroppable()})))}function mediaLibraryOrganizerTreeViewDestroyJsTree(){var e;(e=jQuery)(".media-library-organizer-tree-view-enabled").length&&e(".media-library-organizer-tree-view-enabled").jstree("destroy")}function mediaLibraryOrganizerTreeViewListInitDraggable(){var e;(e=jQuery)("td.title.column-title strong.has-media-icon, td.tree-view-move span.dashicons-move").draggable({appendTo:"body",revert:!0,cursorAt:{top:10,left:10},helper:function(){var r=e(this).closest("tr").attr("id").split("-")[1],i=[r];e("table.media tbody input:checked").length>0&&e("table.media tbody input:checked").each((function(){e(this).val()!=r&&i.push(e(this).val())}));var a="";return a=i.length>1?"Categorize "+i.length+" Items":"Categorize 1 Item",e('<div id="media-library-organizer-tree-view-draggable" data-attachment-ids="'+i.join(",")+'">'+a+"</div>")}})}function mediaLibraryOrganizerTreeViewGridInitDraggable(){var e;(e=jQuery)("li.attachment").draggable({appendTo:"body",revert:!0,cursorAt:{top:40,left:10},helper:function(){var r=e(this).data("id"),i=[r];if(mediaLibraryOrganizerTreeViewGridSelectedAttachments.length>0)for(var a=0;a<mediaLibraryOrganizerTreeViewGridSelectedAttachments.length;a++)mediaLibraryOrganizerTreeViewGridSelectedAttachments.models[a].id!=r&&i.push(mediaLibraryOrganizerTreeViewGridSelectedAttachments.models[a].id);var t="";return t=i.length>1?"Categorize "+i.length+" Items":"Categorize 1 Item",e('<div id="media-library-organizer-tree-view-draggable" data-attachment-ids="'+i.join(",")+'">'+t+"</div>")}})}function mediaLibraryOrganizerTreeViewInitDroppable(){var e;(e=jQuery)("#media-library-organizer-tree-view-list li.cat-item a").droppable({hoverClass:"media-library-organizer-tree-view-droppable-hover",drop:function(r,i){var a=e(i.helper).data("attachment-ids"),t;a.toString().search(",")&&(a=a.toString().split(",")),e(r.target).parent(),mediaLibraryOrganizerTreeViewAssignAttachmentsToCategory(a,mediaLibraryOrganizerTreeViewGetTermIDFromElement(e(r.target).parent()))}})}function mediaLibraryOrganizerTreeViewGetTermIDFromElement(e){if(void 0===e[0])return!1;if(void 0===e[0].className)return!1;for(var r=e[0].className.split(" "),i=0;i<r.length;i++)if(-1!=r[i].search("cat-item-"))return r[i].replace("cat-item-","");return!1}function mediaLibraryOrganizerTreeViewGetTermNameFromElement(e){return jQuery(e).contents().filter((function(){return 3==this.nodeType}))[0].nodeValue.trim()}var mediaLibraryOrganizerTreeViewGridSelectedAttachments,mediaLibraryOrganizerTreeViewGridModified;"grid"==media_library_organizer_tree_view.media_view&&(jQuery(document).ready((function(e){var r;new MutationObserver(mediaLibraryOrganizerTreeViewGridInitDraggable).observe(document.querySelector(".attachments-browser ul.attachments"),{childList:!0})})),function(e,r){r.extend(wp.media.view.AttachmentFilters.prototype,{select:function(){mediaLibraryOrganizerTreeViewGridSelectedAttachments=this.controller.state().get("selection")}}),r.extend(wp.media.controller.Library.prototype,{refreshContent:function(){mediaLibraryOrganizerTreeViewGridSelectedAttachments=this.get("selection")}})}(jQuery,_)),jQuery(document).ready((function(e){if(e("body").hasClass("upload-php")){e(".wrap").wrap('<div class="media-library-organizer-tree-view"></div>'),e(".media-library-organizer-tree-view").prepend(e("#media-library-organizer-tree-view")),e("#media-library-organizer-tree-view").show();var r=new StickySidebar("#media-library-organizer-tree-view",{containerSelector:".media-library-organizer-tree-view",innerWrapperSelector:".media-library-organizer-tree-view-inner"});0!=media_library_organizer_tree_view.context_menu&&mediaLibraryOrganizerTreeViewContextMenuInit(),mediaLibraryOrganizerTreeViewInitJsTree(),mediaLibraryOrganizerTreeViewListInitDraggable(),mediaLibraryOrganizerTreeViewInitDroppable(),mediaLibraryOrganizerTreeViewContextualButtons(),e("body").on("click",".media-library-organizer-tree-view-add",(function(r){var i;r.preventDefault(),mediaLibraryOrganizerTreeViewAddCategory(mediaLibraryOrganizerTreeViewGetTermIDFromElement(e("#media-library-organizer-tree-view-list .current-cat")))})),e("body").on("click",".media-library-organizer-tree-view-edit",(function(r){var i,a;r.preventDefault(),mediaLibraryOrganizerTreeViewEditCategory(mediaLibraryOrganizerTreeViewGetTermIDFromElement(e("#media-library-organizer-tree-view-list .current-cat")),mediaLibraryOrganizerTreeViewGetTermNameFromElement(e("#media-library-organizer-tree-view-list .current-cat a")))})),e("body").on("click",".media-library-organizer-tree-view-delete",(function(r){var i,a;r.preventDefault(),mediaLibraryOrganizerTreeViewDeleteCategory(mediaLibraryOrganizerTreeViewGetTermIDFromElement(e("#media-library-organizer-tree-view-list .current-cat")),mediaLibraryOrganizerTreeViewGetTermNameFromElement(e("#media-library-organizer-tree-view-list .current-cat a")))}))}})),wp.media.events.on("mlo:grid:tree-view:added:term",(function(e){!function(r){switch(e.media_view){case"list":mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e.taxonomy.name,e.dropdown_filter,e.selected_term);break;case"grid":MediaLibraryOrganizerAttachmentsBrowser.controller.isModeActive("select")||mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items);break}}(jQuery)})),wp.media.events.on("mlo:grid:tree-view:edited:term",(function(e){!function(r){switch(e.media_view){case"list":mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e.taxonomy.name,e.dropdown_filter,e.selected_term),mediaLibraryOrganizerListViewUpdateAttachmentTerms(e.taxonomy.name,e.old_term,e.term);break;case"grid":MediaLibraryOrganizerAttachmentsBrowser.controller.isModeActive("select")||mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items),void 0!==wp.media.frame.library?wp.media.frame.library.props.set({ignore:+new Date}):(wp.media.frame.content.get().collection.props.set({ignore:+new Date}),wp.media.frame.content.get().options.selection.reset());break}}(jQuery)})),wp.media.events.on("mlo:grid:tree-view:deleted:term",(function(e){!function(r){switch(e.media_view){case"list":if(e.selected_term==e.term.slug)return void(window.location.href="upload.php?mode=list");mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e.taxonomy.name,e.dropdown_filter,e.selected_term),mediaLibraryOrganizerListViewUpdateAttachmentTerms(e.taxonomy.name,e.term,!1);break;case"grid":if(e.selected_term==e.term.slug)return void(window.location.href="upload.php?mode=grid");MediaLibraryOrganizerAttachmentsBrowser.controller.isModeActive("select")||mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items),void 0!==wp.media.frame.library?wp.media.frame.library.props.set({ignore:+new Date}):(wp.media.frame.content.get().collection.props.set({ignore:+new Date}),wp.media.frame.content.get().options.selection.reset());break}}(jQuery)})),wp.media.events.on("mlo:grid:tree-view:assigned:attachments:term",(function(e){!function(r){switch(e.media_view){case"list":mediaLibraryOrganizerListViewReplaceTaxonomyFilter(e.taxonomy.name,e.dropdown_filter,media_library_organizer_tree_view.selected_term);for(let a in e.attachments){var i=[];for(j=0;j<e.attachments[a].terms.length;j++)i.push('<a href="upload.php?taxonomy='+e.attachments[a].terms[j].taxonomy+"&term="+e.attachments[a].terms[j].slug+'">'+e.attachments[a].terms[j].name+"</a>");r("tr#post-"+e.attachments[a].id+" td.taxonomy-"+e.taxonomy.name).html(i.join(", "))}break;case"grid":MediaLibraryOrganizerAttachmentsBrowser.controller.isModeActive("select")||mediaLibraryOrganizerGridViewReplaceTaxonomyFilter(e.taxonomy.name,e.terms,e.taxonomy.labels.all_items);break}e.taxonomy.name==media_library_organizer_tree_view.taxonomy.name&&mediaLibraryOrganizerTreeViewGet(e.taxonomy.name,e.selected_term)}(jQuery)})),wp.media.events.on("mlo:grid:edit-attachment:added:term",(function(e){e.taxonomy.name==media_library_organizer_tree_view.taxonomy.name&&mediaLibraryOrganizerTreeViewGet(e.taxonomy.name,media_library_organizer_tree_view.selected_term)})),wp.media.events.on("mlo:grid:edit-attachment:edited",(function(e){var r;r=jQuery,e.taxonomy_term_changed&&mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.taxonomy.name,media_library_organizer_tree_view.selected_term)})),wp.media.events.on("mlo:grid:filter:change:term",(function(e){e.taxonomy_name==media_library_organizer_tree_view.taxonomy.name&&(media_library_organizer_tree_view.selected_term=e.slug,mediaLibraryOrganizerTreeViewGet(e.taxonomy_name,e.slug))})),wp.media.events.on("mlo:grid:attachment:upload:success",(function(e){mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.taxonomy.name,media_library_organizer_tree_view.selected_term)})),wp.media.events.on("mlo:grid:edit-attachment:deleted",(function(e){mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.taxonomy.name,media_library_organizer_tree_view.selected_term)})),wp.media.events.on("mlo:grid:attachments:bulk_actions:done",(function(){console.log("mlo:grid:attachments:bulk_actions:done"),mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.taxonomy.name,media_library_organizer_tree_view.selected_term)}));