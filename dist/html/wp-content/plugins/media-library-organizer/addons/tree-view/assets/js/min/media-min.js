function mediaLibraryOrganizerTreeViewContextMenuInit(){var e;(e=jQuery)("#media-library-organizer-tree-view-list").contextmenu({delegate:".cat-item",menu:media_library_organizer_tree_view.context_menu,select:function(e,r){var i=mediaLibraryOrganizerTreeViewGetTermIDFromElement(r.target.parent()),a=r.target.text();switch(r.cmd){case"create_term":mediaLibraryOrganizerTreeViewAddCategory(i);break;case"edit_term":mediaLibraryOrganizerTreeViewEditCategory(i,a);break;case"delete_term":mediaLibraryOrganizerTreeViewDeleteCategory(i,a);break}}})}function mediaLibraryOrganizerTreeViewAddCategory(e){var r,i;r=jQuery,(i=prompt(media_library_organizer_tree_view.create_term.prompt))&&i.length&&r.post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.create_term.action,nonce:media_library_organizer_tree_view.create_term.nonce,term_name:i,term_parent_id:e,"mlo-category":media_library_organizer_tree_view.selected_term},(function(e){if(e.success){switch(wp.media.events.trigger("mlo:grid:tree-view:added:mlo-category",{term:e.data.term}),media_library_organizer_tree_view.media_view){case"list":r("select#mlo-category").replaceWith(e.data.dropdown_filter),r("select#mlo-category").val(media_library_organizer_tree_view.selected_term);break;case"grid":break}mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.selected_term)}else alert(e.data)}))}function mediaLibraryOrganizerTreeViewEditCategory(e,r){!function(i){if(e){var a=prompt(media_library_organizer_tree_view.edit_term.prompt,r);a&&a.length&&i.post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.edit_term.action,nonce:media_library_organizer_tree_view.edit_term.nonce,term_id:e,term_name:a,"mlo-category":media_library_organizer_tree_view.selected_term},(function(e){if(e.success){switch(wp.media.events.trigger("mlo:grid:tree-view:edited:mlo-category",{term:e.data.term}),media_library_organizer_tree_view.media_view){case"list":i("select#mlo-category").replaceWith(e.data.dropdown_filter),i("td.taxonomy-"+e.data.term.taxonomy+" a").each((function(){i(this).text()==e.data.old_term.name&&(i(this).text(e.data.term.name),i(this).attr("href","upload.php?taxonomy="+e.data.term.taxonomy+"&term="+e.data.term.slug))}));break;case"grid":void 0!==wp.media.frame.library?wp.media.frame.library.props.set({ignore:+new Date}):(wp.media.frame.content.get().collection.props.set({ignore:+new Date}),wp.media.frame.content.get().options.selection.reset());break}mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.selected_term)}else alert(e.data)}))}else alert(media_library_organizer_tree_view.edit_term.no_selection)}(jQuery)}function mediaLibraryOrganizerTreeViewDeleteCategory(e,r){var i,a;i=jQuery,e?confirm(media_library_organizer_tree_view.delete_term.prompt+" "+r)&&i.post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.delete_term.action,nonce:media_library_organizer_tree_view.delete_term.nonce,term_id:e,"mlo-category":media_library_organizer_tree_view.selected_term},(function(e){if(e.success){switch(wp.media.events.trigger("mlo:grid:tree-view:deleted:mlo-category",{term:e.data.term}),media_library_organizer_tree_view.media_view){case"list":i("select#mlo-category").replaceWith(e.data.dropdown_filter),i("select#mlo-category").val(media_library_organizer_tree_view.selected_term),i("td.taxonomy-"+e.data.term.taxonomy+" a").each((function(){i(this).text()==e.data.term.name&&i(this).remove()})),i("td.taxonomy-"+e.data.term.taxonomy).each((function(){i(this).html(i(this).html().replace(/(^\s*,)|(,\s*$)/g,""))}));break;case"grid":void 0!==wp.media.frame.library?wp.media.frame.library.props.set({ignore:+new Date}):(wp.media.frame.content.get().collection.props.set({ignore:+new Date}),wp.media.frame.content.get().options.selection.reset());break}mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.selected_term)}else alert(e.data)})):alert(media_library_organizer_tree_view.delete_term.no_selection)}function mediaLibraryOrganizerTreeViewAssignAttachmentsToCategory(e,r){var a;a=jQuery,e&&r&&a.post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.categorize_attachments.action,nonce:media_library_organizer_tree_view.categorize_attachments.nonce,attachment_ids:e,term_id:r},(function(t){if(!t.success)return alert(t.data),void wpzinc_notification_show_error_message(t.data);if(wp.media.events.trigger("mlo:grid:tree-view:assigned:attachments:mlo-category",{term_id:r,attachment_ids:e,attachments:t.data.attachments}),wpzinc_notification_show_success_message(t.data.attachments.length+" Attachments Categorized."),t.data.attachments.length>0)for(i=0;i<t.data.attachments.length;i++){var n=t.data.attachments[i];switch(media_library_organizer_tree_view.media_view){case"list":var o=[];for(j=0;j<n.terms.length;j++)o.push('<a href="upload.php?taxonomy='+n.terms[j].taxonomy+"&term="+n.terms[j].slug+'">'+n.terms[j].name+"</a>");a("tr#post-"+n.id+" td.taxonomy-"+n.terms[0].taxonomy).html(o.join(", "));break;case"grid":void 0!==wp.media.frame.library?wp.media.frame.library.props.set({ignore:+new Date}):(wp.media.frame.content.get().collection.props.set({ignore:+new Date}),wp.media.frame.content.get().options.selection.reset());break}}mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.selected_term)}))}function mediaLibraryOrganizerTreeViewContextualButtons(){var e;(e=jQuery)("#media-library-organizer-tree-view-list .current-cat").length?(e("button.media-library-organizer-tree-view-edit").prop("disabled",!1),e("button.media-library-organizer-tree-view-delete").prop("disabled",!1)):(e("button.media-library-organizer-tree-view-edit").prop("disabled",!0),e("button.media-library-organizer-tree-view-delete").prop("disabled",!0))}function mediaLibraryOrganizerTreeViewGet(e){var r;(r=jQuery).post(media_library_organizer_tree_view.ajaxurl,{action:media_library_organizer_tree_view.get_tree_view.action,nonce:media_library_organizer_tree_view.get_tree_view.nonce,current_term:e},(function(e){if(!e.success)return!1;mediaLibraryOrganizerTreeViewDestroyJsTree(),r("#media-library-organizer-tree-view-list").html(e.data),mediaLibraryOrganizerTreeViewInitJsTree(),mediaLibraryOrganizerTreeViewContextualButtons(),mediaLibraryOrganizerTreeViewInitDroppable(),wp.media.events.trigger("mlo:grid:tree-view:loaded")}))}function mediaLibraryOrganizerTreeViewInitJsTree(){var e;(e=jQuery)(".media-library-organizer-tree-view-enabled").length&&(e("li.current-cat-ancestor",e(".media-library-organizer-tree-view-enabled")).each((function(){e(this).addClass("jstree-open")})),e(".media-library-organizer-tree-view-enabled").jstree().bind("select_node.jstree",(function(e,r){document.location.href=r.node.a_attr.href})).bind("open_node.jstree",(function(e,r){mediaLibraryOrganizerTreeViewInitDroppable()})))}function mediaLibraryOrganizerTreeViewDestroyJsTree(){var e;(e=jQuery)(".media-library-organizer-tree-view-enabled").length&&e(".media-library-organizer-tree-view-enabled").jstree("destroy")}function mediaLibraryOrganizerTreeViewListInitDraggable(){var e;(e=jQuery)("td.title.column-title strong.has-media-icon, td.tree-view-move span.dashicons-move").draggable({appendTo:"body",revert:!0,cursorAt:{top:10,left:10},helper:function(){var r=e(this).closest("tr").attr("id").split("-")[1],i=[r];e("table.media tbody input:checked").length>0&&e("table.media tbody input:checked").each((function(){e(this).val()!=r&&i.push(e(this).val())}));var a="";return a=i.length>1?"Categorize "+i.length+" Items":"Categorize 1 Item",e('<div id="media-library-organizer-tree-view-draggable" data-attachment-ids="'+i.join(",")+'">'+a+"</div>")}})}function mediaLibraryOrganizerTreeViewGridInitDraggable(){var e;(e=jQuery)("li.attachment").draggable({appendTo:"body",revert:!0,cursorAt:{top:40,left:10},helper:function(){var r=e(this).data("id"),i=[r];if(mediaLibraryOrganizerTreeViewGridSelectedAttachments.length>0)for(var a=0;a<mediaLibraryOrganizerTreeViewGridSelectedAttachments.length;a++)mediaLibraryOrganizerTreeViewGridSelectedAttachments.models[a].id!=r&&i.push(mediaLibraryOrganizerTreeViewGridSelectedAttachments.models[a].id);var t="";return t=i.length>1?"Categorize "+i.length+" Items":"Categorize 1 Item",e('<div id="media-library-organizer-tree-view-draggable" data-attachment-ids="'+i.join(",")+'">'+t+"</div>")}})}function mediaLibraryOrganizerTreeViewGridDestroyDraggable(){var e;(e=jQuery)("li.attachment").data("ui-draggable")&&e("li.attachment").draggable("destroy")}function mediaLibraryOrganizerTreeViewInitDroppable(){var e;(e=jQuery)("#media-library-organizer-tree-view-list li.cat-item a").droppable({hoverClass:"media-library-organizer-tree-view-droppable-hover",drop:function(r,i){var a=e(i.helper).data("attachment-ids"),t;a.toString().search(",")&&(a=a.toString().split(",")),e(r.target).parent(),mediaLibraryOrganizerTreeViewAssignAttachmentsToCategory(a,mediaLibraryOrganizerTreeViewGetTermIDFromElement(e(r.target).parent()))}})}function mediaLibraryOrganizerTreeViewGetTermIDFromElement(e){if(void 0===e[0])return!1;if(void 0===e[0].className)return!1;for(var r=e[0].className.split(" "),i=0;i<r.length;i++)if(-1!=r[i].search("cat-item-"))return r[i].replace("cat-item-","");return!1}var mediaLibraryOrganizerTreeViewGridSelectedAttachments,mediaLibraryOrganizerTreeViewGridModified;"grid"==media_library_organizer_tree_view.media_view&&function(e,r){r.extend(wp.media.view.AttachmentFilters.prototype,{select:function(){mediaLibraryOrganizerTreeViewGridSelectedAttachments=this.controller.state().get("selection"),clearTimeout(mediaLibraryOrganizerTreeViewGridModified),mediaLibraryOrganizerTreeViewGridModified=setTimeout((function(){mediaLibraryOrganizerTreeViewGridDestroyDraggable(),mediaLibraryOrganizerTreeViewGridInitDraggable()}),500)}}),r.extend(wp.media.controller.Library.prototype,{refreshContent:function(){mediaLibraryOrganizerTreeViewGridSelectedAttachments=this.get("selection")}})}(jQuery,_),jQuery(document).ready((function(e){if(e("body").hasClass("upload-php")){e(".wrap").wrap('<div class="media-library-organizer-tree-view"></div>'),e(".media-library-organizer-tree-view").prepend(e("#media-library-organizer-tree-view")),e("#media-library-organizer-tree-view").show();var r=new StickySidebar("#media-library-organizer-tree-view",{containerSelector:".media-library-organizer-tree-view",innerWrapperSelector:".media-library-organizer-tree-view-inner"});0!=media_library_organizer_tree_view.context_menu&&mediaLibraryOrganizerTreeViewContextMenuInit(),mediaLibraryOrganizerTreeViewInitJsTree(),mediaLibraryOrganizerTreeViewListInitDraggable(),mediaLibraryOrganizerTreeViewInitDroppable(),mediaLibraryOrganizerTreeViewContextualButtons(),e("body").on("click",".media-library-organizer-tree-view-add",(function(r){var i;r.preventDefault(),mediaLibraryOrganizerTreeViewAddCategory(mediaLibraryOrganizerTreeViewGetTermIDFromElement(e("#media-library-organizer-tree-view-list .current-cat")))})),e("body").on("click",".media-library-organizer-tree-view-edit",(function(r){r.preventDefault();var i=mediaLibraryOrganizerTreeViewGetTermIDFromElement(e("#media-library-organizer-tree-view-list .current-cat"));term_name=e("#media-library-organizer-tree-view-list .current-cat a").text(),mediaLibraryOrganizerTreeViewEditCategory(i,term_name)})),e("body").on("click",".media-library-organizer-tree-view-delete",(function(r){r.preventDefault();var i=mediaLibraryOrganizerTreeViewGetTermIDFromElement(e("#media-library-organizer-tree-view-list .current-cat"));term_name=e("#media-library-organizer-tree-view-list .current-cat a").text(),mediaLibraryOrganizerTreeViewDeleteCategory(i,term_name)}))}})),wp.media.events.on("mlo:grid:filter:change:mlo-category",(function(e){mediaLibraryOrganizerTreeViewGet(e.slug)})),wp.media.events.on("mlo:grid:attachments:received",(function(e){clearTimeout(mediaLibraryOrganizerTreeViewGridModified),mediaLibraryOrganizerTreeViewGridModified=setTimeout((function(){mediaLibraryOrganizerTreeViewGridInitDraggable()}),500)})),wp.media.events.on("mlo:grid:attachment:upload:success",(function(e){mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.selected_term),clearTimeout(mediaLibraryOrganizerTreeViewGridModified),mediaLibraryOrganizerTreeViewGridModified=setTimeout((function(){mediaLibraryOrganizerTreeViewGridInitDraggable()}),500)})),wp.media.events.on("mlo:grid:attachments:bulk_actions:done",(function(){setTimeout((function(){mediaLibraryOrganizerTreeViewGet(media_library_organizer_tree_view.selected_term)}),500)}));